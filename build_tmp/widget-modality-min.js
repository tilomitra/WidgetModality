YUI.add("widget-modality",function(b){var i="widget",p="host",o="renderUI",j="bindUI",q="syncUI",l="rendered",m="boundingBox",n="contentBox",k="visible",f="zIndex",g="align",h="Change",c=b.Lang.isBoolean,e=b.ClassNameManager.getClassName,a=(function(){
/*! IS_POSITION_FIXED_SUPPORTED - Juriy Zaytsev (kangax) - http://yura.thinkweb2.com/cft/ */
var s=null,t,r;if(document.createElement){t=document.createElement("div");if(t&&t.style){t.style.position="fixed";t.style.top="10px";r=document.body;if(r&&r.appendChild&&r.removeChild){r.appendChild(t);s=(t.offsetTop===10);r.removeChild(t);}}}return s;}()),d;(function(){var u="widgetModal",t="modal",s="mask",r={modal:e(i,t)},v={mask:e(i,s)};d=b.Base.create(u,b.Plugin.Base,[],{_maskNode:null,_uiHandles:null,initializer:function(x){var w=this;this.afterHostMethod(o,this.renderUI);this.afterHostMethod(j,this.bindUI);this.afterHostMethod(q,this.syncUI);if(this.get(p).get(l)){this.renderUI();this.bindUI();this.syncUI();}this._maskNode=d._GET_MASK();},destructor:function(){if(this._maskNode){this._maskNode.remove(true);}this._detachUIHandles();this.get(p).get(m).removeClass(r.modal);},renderUI:function(){var x=this.get(p).get(m),w=this.get(p).get(n);w.setStyles({position:"relative"});this._repositionMask(this.get(p));x.addClass(r.modal);},bindUI:function(){this.afterHostEvent(k+h,this._afterHostVisibleChange);this.afterHostEvent(f+h,this._afterHostZIndexChange);},syncUI:function(){var w=this.get(p);this._uiSetHostVisible(w.get(k));this._uiSetHostZIndex(w.get(f));},_focus:function(y){var x=this.get(p),z=x.get(m),w=z.get("tabIndex");z.set("tabIndex",w>=0?w:0);x.focus();},_blur:function(){this.get(p).blur();},_getMaskNode:function(){return d._GET_MASK();},_uiSetHostVisible:function(C){var x=this,D=this.get(p).get("id"),w=d.STACK.length;if(C){for(var z=0;z<w;z++){d.STACK[z].modal._detachUIHandles();d.STACK[z].modal._blur();}d.STACK.push({host:x.get("host"),modal:x,id:D});console.log(d.STACK);this._attachUIHandles();this._repositionMask(this.get(p));this._uiSetHostZIndex(this.get(p).get(f));this._maskNode.setStyle("display","block");this._focus();}else{for(var y=0;y<d.STACK.length;y++){if(d.STACK[y].id===D){var B=d.STACK.pop();console.log(d.STACK);B.modal._detachUIHandles();B.modal._blur();}}if(d.STACK.length===0){this._maskNode.setStyle("display","none");}else{var A=d.STACK[d.STACK.length-1].host;this._repositionMask(A);A.modal.bindUI();A.modal._attachUIHandles();A.modal._uiSetHostZIndex(A.get(f));A.modal._focus();}}},_uiSetHostZIndex:function(w){this._maskNode.setStyle(f,w||0);},_attachUIHandles:function(x){if(this._uiHandles){return;}var w=this.get(p),y=w.get(m);this._uiHandles=[y.on("clickoutside",b.bind(this._focus,this)),y.on("focusoutside",b.bind(this._focus,this)),];if(!a){this._uiHandles.push(b.one("win").on("scroll",b.bind(function(A){var z=this._maskNode;z.setStyle("top",z.get("docScrollY"));},this)));}},_detachUIHandles:function(){console.log(this);b.each(this._uiHandles,function(w){w.detach();});this._uiHandles=null;},_afterHostVisibleChange:function(w){this._uiSetHostVisible(w.newVal);},_afterHostZIndexChange:function(w){this._uiSetHostZIndex(w.newVal);},_isNested:function(){var w=d._GET_MASK();return w.get(k);},_repositionMask:function(x){this._maskNode.remove();var y=x.get(m),w=y.get("parentNode")||b.one("body");w.insert(this._maskNode,w.get("firstChild"));}},{NS:t,ATTRS:{maskNode:{getter:"_getMaskNode",readOnly:true},node:{value:undefined}},CLASSES:r,_GET_MASK:function(){var w=b.one("#yui3-widget-mask")||null;if(w){return w;}else{w=b.Node.create("<div></div>");w.set("id",v.mask);w.setStyles({position:a?"fixed":"absolute",width:"100%",height:"100%",top:"0",left:"0",display:"block"});return w;}},STACK:[]});b.namespace("Plugin").Modal=d;}());},"@VERSION@",{requires:["widget","plugin","gallery-outside-events"]});